import { get } from "svelte/store";
import type { App } from "../applogic/interface";
import { ArcOSVersion } from "../env/main";
import { ErrorButton, ErrorMessage, ErrorMessages } from "./app";
import icon from "../../assets/apps/errordialog.svg";

export function getErrorElement(id: string): HTMLDivElement {
  const el = document.querySelector(`div.window#${id}`);

  return el as HTMLDivElement;
}

export function errorMessage(
  title: string,
  message: string,
  ...buttons: ErrorButton[]
) {
  const error: ErrorMessage = {
    title,
    message,
    opened: false,
    buttons,
  };

  const em = get(ErrorMessages);

  em.push(error);

  ErrorMessages.set(em);
}

export function createErrorAppData(data: ErrorMessage): App {
  const error: App = {
    info: {
      name: data.title,
      description: "ArcOS.Desktop.ErrorLogic.Window",
      builtin: true,
      version: ArcOSVersion,
      author: "Generated by ArcOS",
      icon,
    },
    size: { w: NaN, h: NaN },
    pos: { x: 30, y: 40 },
    minSize: { w: 200, h: NaN },
    maxSize: { w: 600, h: NaN },
    controls: { min: false, max: false, cls: true },
    state: {
      headless: false,
      resizable: false,
      windowState: { min: false, max: false, fll: false },
    },
    content: null,
    glass: false,
    id: `error_${Math.floor(Math.random() * 1e9)}`,
  };

  return error;
}
